(()=>{"use strict";var t={56:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},72:t=>{var e=[];function n(t){for(var n=-1,r=0;r<e.length;r++)if(e[r].identifier===t){n=r;break}return n}function r(t,r){for(var s={},i=[],a=0;a<t.length;a++){var c=t[a],l=r.base?c[0]+r.base:c[0],h=s[l]||0,d="".concat(l," ").concat(h);s[l]=h+1;var p=n(d),u={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==p)e[p].references++,e[p].updater(u);else{var f=o(u,r);r.byIndex=a,e.splice(a,0,{identifier:d,updater:f,references:1})}i.push(d)}return i}function o(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,o){var s=r(t=t||[],o=o||{});return function(t){t=t||[];for(var i=0;i<s.length;i++){var a=n(s[i]);e[a].references--}for(var c=r(t,o),l=0;l<s.length;l++){var h=n(s[l]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}s=c}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",r=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),r&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),r&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,r,o,s){"string"==typeof t&&(t=[[null,t,void 0]]);var i={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(i[c]=!0)}for(var l=0;l<t.length;l++){var h=[].concat(t[l]);r&&i[h[0]]||(void 0!==s&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=s),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),o&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=o):h[4]="".concat(o)),e.push(h))}},e}},365:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(601),o=n.n(r),s=n(314),i=n.n(s)()(o());i.push([t.id,'.cityEditor {\n  font-size: 1.5rem;\n  font-family: "Roboto", sans-serif;\n  font-weight: 300;\n  color: #333;\n}\n\n.showButton {\n  font-size: 1.5rem;\n  font-family: "Roboto", sans-serif;\n  font-weight: 300;\n  color: #333;\n}\n\n.cityMapImage {\n  display: block;\n  width: 450px;\n  height: 450px;\n}\n\n.weatherInfo {\n  font-size: 1.5rem;\n  font-family: "Roboto", sans-serif;\n  font-weight: 300;\n  color: #333;\n}\n\n.sectionHistory {\n  font-size: 1.5rem;\n  font-family: "Roboto", sans-serif;\n  font-weight: 300;\n  color: #333;\n}\n',""]);const a=i},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{t.exports=function(t){return t[1]}},659:t=>{var e={};t.exports=function(t,n){var r=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(r,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var s=e[r]={id:r,exports:{}};return t[r](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0;var r=n(72),o=n.n(r),s=n(825),i=n.n(s),a=n(659),c=n.n(a),l=n(56),h=n.n(l),d=n(540),p=n.n(d),u=n(113),f=n.n(u),m=n(365),y={};y.styleTagTransform=f(),y.setAttributes=h(),y.insert=c().bind(null,"head"),y.domAPI=i(),y.insertStyleElement=p(),o()(m.A,y),m.A&&m.A.locals&&m.A.locals;const w=(t,e={},n="")=>{const r=document.createElement(t);return Object.entries(e).forEach((([t,e])=>{r.setAttribute(t,e)})),n&&(r.innerText=n),r};class v{constructor(t){this.onSearch=t,this.element=this.render(),this.setupEventListeners()}render(){const t=w("form",{class:"sectionInput"});return this.input=w("input",{class:"cityEditor",type:"text",placeholder:"Введите название города"}),this.button=w("button",{class:"showButton",type:"button"},"Показать"),t.appendChild(this.input),t.appendChild(this.button),t}setupEventListeners(){this.button.addEventListener("click",(()=>{this.search()})),this.element.addEventListener("submit",(t=>{t.preventDefault(),this.search()})),this.input.addEventListener("keypress",(t=>{"Enter"===t.key&&(t.preventDefault(),this.search())}))}search(){const t=this.input.value.trim();t&&this.onSearch(t)}setCity(t){this.input.value=t}getCity(){return this.input.value.trim()}}class g{constructor(){this.element=this.render()}render(){const t=w("section",{class:"sectionMap"});return this.image=w("img",{class:"cityMapImage",alt:"Карта города"}),t.appendChild(this.image),t}updateMap(t,e){this.image.src=((t,e)=>`https://static-maps.yandex.ru/1.x/?${new URLSearchParams({l:"map",size:"450,450",z:"11",ll:`${t},${e}`,pt:`${t},${e},pm2rdm`})}`)(t,e)}}class C{constructor(){this.element=this.render()}render(){const t=w("section",{class:"sectionWeather"});return this.info=w("p",{class:"weatherInfo"},"Информация о погоде"),t.appendChild(this.info),t}setLoading(t){this.info.innerText=`Загрузка данных для города ${t}...`}setError(t){this.info.innerText=`Ошибка при загрузке данных для города ${t}`}async updateWeather(t,e){try{const n=await(async(t,e)=>{try{const e=`http://api.openweathermap.org/data/2.5/weather?${new URLSearchParams({lat:t.lat,lon:t.lon,appid:"ce2efde41862706bd2d4973c702caa1b",units:"metric",lang:"ru"})}`,r=await fetch(e);if(!r.ok)throw new Error(`Ошибка API: ${r.status} ${r.statusText}`);const o=await r.json();return{temp:Math.round(o.main.temp),feelsLike:Math.round(o.main.feels_like),humidity:o.main.humidity,pressure:Math.round(.75*o.main.pressure),windSpeed:o.wind.speed,windDirection:(n=o.wind.deg,["северный","северо-восточный","восточный","юго-восточный","южный","юго-западный","западный","северо-западный"][Math.round(n/45)%8]),condition:o.weather[0].description,icon:`https://openweathermap.org/img/wn/${o.weather[0].icon}@2x.png`,city:o.name,country:o.sys.country}}catch(t){throw console.error("Ошибка при получении данных о погоде:",t),new Error(`Не удалось получить данные о погоде для города ${e}`)}var n})({lat:t.latitude,lon:t.longitude},e);return this.info.innerText=`Город: ${e}\nТемпература: ${n.temp}°C\nПогода: ${n.condition}`,!0}catch(t){return this.setError(e),console.error(t),!1}}}const b="weatherSearchHistory",x=()=>{const t=localStorage.getItem(b);return t?JSON.parse(t):["Москва","Лондон","Нью-Йорк"]};class E{constructor(t){this.onCitySelect=t,this.element=this.render(),this.updateDisplay()}render(){const t=w("section",{class:"sectionHistory"}),e=w("label",{class:"historyLabel"},"История поиска"),n=w("hr");return this.list=w("ul",{class:"historyList"}),t.appendChild(e),t.appendChild(n),t.appendChild(this.list),t}updateDisplay(){this.list.innerHTML="",x().forEach((t=>{const e=w("li",{class:"history-item"},t);e.addEventListener("click",(()=>{this.onCitySelect(t)})),this.list.appendChild(e)}))}addCity(t){(t=>{let e=x();const n=e.indexOf(t);-1!==n&&e.splice(n,1),e.unshift(t),e=e.slice(0,10),localStorage.setItem(b,JSON.stringify(e))})(t),this.updateDisplay()}}class I{constructor(){this.app=document.querySelector(".app"),this.initComponents(),this.mountComponents(),this.loadCurrentLocation()}initComponents(){this.cityInput=new v(this.searchCity.bind(this)),this.weatherMap=new g,this.weatherInfo=new C,this.searchHistory=new E(this.selectCityFromHistory.bind(this))}mountComponents(){this.app.appendChild(this.cityInput.element),this.app.appendChild(this.weatherMap.element),this.app.appendChild(this.weatherInfo.element),this.app.appendChild(this.searchHistory.element)}async searchCity(t){this.weatherInfo.setLoading(t);try{const e=await(async t=>{try{const e=`https://geocode-maps.yandex.ru/1.x/?${new URLSearchParams({apikey:"db731357-dfe6-4929-944b-b4ab85d8cddd",format:"json",geocode:t,results:1})}`,n=await fetch(e);if(!n.ok)throw new Error(`Ошибка API геокодера: ${n.status} ${n.statusText}`);const r=(await n.json()).response.GeoObjectCollection.featureMember;if(!r||0===r.length)throw new Error(`Город "${t}" не найден`);const o=r[0].GeoObject.Point.pos.split(" "),s=r[0].GeoObject;return{longitude:parseFloat(o[0]),latitude:parseFloat(o[1]),fullName:r[0].GeoObject.metaDataProperty.GeocoderMetaData.text,shortName:s.name}}catch(e){throw console.error("Ошибка при получении координат:",e),new Error(`Не удалось получить координаты для города ${t}`)}})(t);this.weatherMap.updateMap(e.longitude,e.latitude),await this.weatherInfo.updateWeather(e,t)&&this.searchHistory.addCity(e.shortName||t)}catch(e){this.weatherInfo.setError(t),console.error(e)}}selectCityFromHistory(t){this.cityInput.setCity(t),this.searchCity(t)}loadCurrentLocation(){navigator.geolocation?(this.weatherInfo.info.innerText="Определение вашего местоположения...",navigator.geolocation.getCurrentPosition((async t=>{try{const e=t.coords.latitude,n=t.coords.longitude;console.log("Текущие координаты:",e,n),this.weatherMap.updateMap(n,e);const r=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${e}&lon=${n}&format=json`);if(!r.ok)throw new Error("Ошибка при определении местоположения");const o=await r.json(),s=o.address.city||o.address.town||o.address.village||o.address.county||"Неизвестное местоположение";console.log("Определенное местоположение:",s),this.cityInput.setCity(s),await this.weatherInfo.updateWeather({latitude:e,longitude:n},s),this.searchHistory.addCity(s)}catch(t){console.error("Ошибка при обработке местоположения:",t),this.loadDefaultCity()}}),(t=>{console.error("Ошибка геолокации:",t),this.loadDefaultCity()}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})):(console.log("Геолокация не поддерживается вашим браузером"),this.loadDefaultCity())}loadDefaultCity(){const t="Москва";this.cityInput.setCity(t),this.searchCity(t)}}document.addEventListener("DOMContentLoaded",(()=>{new I}))})();